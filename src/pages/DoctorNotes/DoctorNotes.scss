/* Trước khi import variables.scss, định nghĩa các biến fallback */
$primary-color: #ff6b81 !default;
$secondary-color: #ffdde1 !default;
$pastel-purple: #a29bfe !default;
$text-dark: #333333 !default;
$text-medium: #666666 !default;
$glass-bg: rgba(255, 255, 255, 0.75) !default;
$glass-border: rgba(255, 209, 220, 0.25) !default;

/* Sau đó import variables.scss để cho phép ghi đè giá trị từ file này */
@import '../../styles/variables.scss';
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap');

/* Doctor Notes - Local Variables */
$doctor-primary: $primary-color;
$doctor-secondary: $secondary-color;
$doctor-accent: $pastel-purple;
$doctor-dark: $text-dark;
$doctor-gradient: linear-gradient(135deg, $primary-color, darken($primary-color, 15%));
$alert-danger: #ff4d4f;
$alert-warning: #faad14;
$text-primary: $text-dark;
$text-secondary: $text-medium;
$white: #ffffff;
$black: #000000;
$border-radius-sm: 4px;
$border-radius-md: 10px;
$border-radius-lg: 20px;
$border-radius-circle: 50%;
$spacing-xs: 0.5rem;
$spacing-sm: 0.75rem;
$spacing-md: 1rem;
$spacing-lg: 1.5rem;
$spacing-xl: 2.5rem;
$font-size-sm: 0.875rem;
$font-size-base: 1rem;
$font-size-lg: 1.25rem;
$font-weight-medium: 500;
$font-weight-bold: 700;
$shadow-sm: 0 4px 8px rgba($primary-color, 0.1);
$shadow-md: 0 8px 16px rgba($primary-color, 0.15);
$shadow-lg: 0 12px 24px rgba($primary-color, 0.2);
$z-index-sticky: 10;
$z-index-modal: 1000;
$transition-base: all 0.3s ease;
$breakpoint-md: 768px;
$breakpoint-lg: 992px;
$breakpoint-xl: 1200px;

/* Animation Keyframes */
@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

@keyframes wave {
  0% { transform: translate(-50%, 0) rotate(0deg); }
  50% { transform: translate(-50%, -2%) rotate(180deg); }
  100% { transform: translate(-50%, 0) rotate(360deg); }
}

@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

@keyframes particle {
  0% { 
    transform: translateY(0) rotate(0deg); 
    opacity: 0;
  }
  20% { opacity: 0.8; }
  80% { opacity: 0.8; }
  100% { 
    transform: translateY(-100vh) rotate(720deg); 
    opacity: 0;
  }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Mixins */
@mixin card {
  background-color: $white;
  border-radius: $border-radius-lg;
  box-shadow: $shadow-md;
  transition: $transition-base;
  
  &:hover {
    box-shadow: $shadow-lg;
    transform: translateY(-5px);
  }
}

@mixin glass-effect {
  background: $glass-bg;
  backdrop-filter: blur(10px);
  border: 1px solid $glass-border;
  border-radius: 20px;
  box-shadow: 0 12px 40px rgba(255, 209, 220, 0.3);
}

/* Main Container Styling */
.doctor-notes-container {
  position: relative;
  max-width: 1200px;
  margin: 0 auto;
  padding: $spacing-lg;
  font-family: 'Poppins', sans-serif;
  overflow: hidden;
  min-height: calc(100vh - 140px);
  
  /* Background Effects */
  .doctor-notes-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    overflow: hidden;
    
    .waves {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      
      .wave {
        position: absolute;
        bottom: -100px;
        left: 50%;
        width: 250%;
        height: 250%;
        background-color: rgba($doctor-secondary, 0.3);
        border-radius: 45%;
        transform: translateX(-50%);
        animation: wave 20s linear infinite;
        
        &:nth-child(2) {
          bottom: -110px;
          background-color: rgba($doctor-secondary, 0.15);
          animation-duration: 25s;
          animation-delay: -3s;
        }
      }
    }
    
    .particles {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      
      .particle {
        position: absolute;
        bottom: -20px;
        width: 15px;
        height: 15px;
        background-color: rgba($doctor-primary, 0.2);
        border-radius: $border-radius-circle;
        animation: particle 12s linear infinite;
        
        @for $i from 1 through 10 {
          &:nth-child(#{$i}) {
            left: ($i * 10%);
            animation-delay: ($i * 0.5s);
            animation-duration: 10s + random(5) + s;
            opacity: 0.1 + random(7) * 0.1;
            width: 10px + random(15) + px;
            height: 10px + random(15) + px;
          }
        }
      }
    }
  }
  
  /* Header Section */
  .doctor-notes-header {
    margin-bottom: $spacing-xl;
    
    h1 {
      color: $doctor-primary;
      font-size: $font-size-lg * 2;
      font-weight: $font-weight-bold;
      margin-bottom: $spacing-md;
      text-align: center;
      position: relative;
      
      .header-icon {
        margin-right: $spacing-sm;
        animation: pulse 3s infinite;
      }
      
      &::after {
        content: '';
        display: block;
        width: 80px;
        height: 4px;
        margin: $spacing-xs auto 0;
        background: $doctor-gradient;
        border-radius: $border-radius-sm;
      }
    }
    
    .search-filter-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: $spacing-md;
      margin-top: $spacing-lg;
      
      .search-box {
        flex: 1;
        position: relative;
        min-width: 280px;
        
        input {
          width: 100%;
          padding: $spacing-sm $spacing-xl $spacing-sm $spacing-md;
          border-radius: $border-radius-md;
          border: 1px solid rgba($doctor-primary, 0.2);
          font-size: $font-size-base;
          transition: $transition-base;
          
          &:focus {
            outline: none;
            border-color: $doctor-primary;
            box-shadow: 0 0 0 3px rgba($doctor-primary, 0.1);
          }
          
          &::placeholder {
            color: rgba($text-secondary, 0.6);
          }
        }
        
        .search-icon {
          position: absolute;
          right: $spacing-sm;
          top: 50%;
          transform: translateY(-50%);
          color: $doctor-primary;
          pointer-events: none;
        }
      }
      
      .filter-box {
        width: 180px;
        
        select {
          width: 100%;
          padding: $spacing-sm;
          border-radius: $border-radius-md;
          border: 1px solid rgba($doctor-primary, 0.2);
          font-size: $font-size-base;
          background-color: $white;
          cursor: pointer;
          transition: $transition-base;
          
          &:focus {
            outline: none;
            border-color: $doctor-primary;
            box-shadow: 0 0 0 3px rgba($doctor-primary, 0.1);
          }
          
          option {
            padding: $spacing-sm;
          }
        }
      }
      
      .add-note-button {
        padding: $spacing-sm $spacing-md;
        background: $doctor-gradient;
        color: $white;
        border: none;
        border-radius: $border-radius-md;
        font-weight: $font-weight-medium;
        cursor: pointer;
        transition: $transition-base;
        display: flex;
        align-items: center;
        gap: $spacing-xs;
        white-space: nowrap;
        
        &:hover {
          transform: translateY(-3px);
          box-shadow: $shadow-md;
        }
      }
    }
  }
  
  /* Notes Grid */
  .notes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: $spacing-lg;
    
    .note-card {
      @include card;
      padding: $spacing-md;
      display: flex;
      flex-direction: column;
      height: 100%;
      position: relative;
      overflow: hidden;
      
      &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 5px;
        background: $doctor-gradient;
        z-index: 1;
      }
      
      .note-header {
        padding-bottom: $spacing-sm;
        margin-bottom: $spacing-sm;
        border-bottom: 1px solid rgba($doctor-primary, 0.1);
        
        .note-title {
          display: flex;
          align-items: center;
          gap: $spacing-xs;
          margin-bottom: $spacing-xs;
          
          .hospital-icon {
            color: $doctor-primary;
          }
          
          h3 {
            font-size: $font-size-lg;
            color: $doctor-dark;
            font-weight: $font-weight-medium;
            margin: 0;
            line-height: 1.4;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
          }
        }
        
        .note-date {
          display: flex;
          align-items: center;
          gap: $spacing-xs;
          font-size: $font-size-sm;
          color: $text-secondary;
          
          .calendar-icon {
            color: $doctor-primary;
            font-size: $font-size-sm;
          }
        }
      }
      
      .note-content {
        flex: 1;
        margin-bottom: $spacing-md;
        
        .diagnosis-section,
        .detail-section {
          margin-bottom: $spacing-sm;
          
          h4 {
            font-size: $font-size-base;
            color: $doctor-primary;
            margin-bottom: $spacing-xs;
            font-weight: $font-weight-medium;
          }
          
          p {
            margin: 0;
            color: $text-secondary;
            font-size: $font-size-sm;
            line-height: 1.6;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
          }
        }
        
        .image-preview {
          position: relative;
          width: 100%;
          height: 150px;
          border-radius: $border-radius-md;
          overflow: hidden;
          cursor: pointer;
          
          img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: $transition-base;
          }
          
          .image-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            padding: $spacing-sm;
            color: $white;
            font-size: $font-size-sm;
            opacity: 0;
            transition: $transition-base;
            text-align: center;
          }
          
          &:hover {
            img {
              transform: scale(1.05);
            }
            
            .image-overlay {
              opacity: 1;
            }
          }
        }
      }
      
      .note-actions {
        display: flex;
        gap: $spacing-sm;
        
        button {
          flex: 1;
          padding: $spacing-xs $spacing-sm;
          font-size: $font-size-sm;
          border: none;
          border-radius: $border-radius-md;
          cursor: pointer;
          transition: $transition-base;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 5px;
          
          &.edit-button {
            background-color: $doctor-secondary;
            color: $doctor-dark;
            
            &:hover {
              background-color: rgba($doctor-primary, 0.2);
              transform: translateY(-2px);
            }
          }
          
          &.delete-button {
            background-color: rgba($alert-danger, 0.1);
            color: $alert-danger;
            
            &:hover {
              background-color: rgba($alert-danger, 0.2);
              transform: translateY(-2px);
            }
          }
        }
      }
    }
    
    .no-notes {
      grid-column: 1 / -1;
      text-align: center;
      padding: $spacing-xl;
      @include glass-effect;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: $spacing-md;
      
      svg {
        color: rgba($doctor-primary, 0.4);
        animation: pulse 2s infinite;
      }
      
      p {
        color: $text-secondary;
        font-size: $font-size-lg;
        margin: 0;
      }
      
      button {
        padding: $spacing-sm $spacing-lg;
        background: $doctor-gradient;
        color: $white;
        border: none;
        border-radius: $border-radius-md;
        font-weight: $font-weight-medium;
        cursor: pointer;
        transition: $transition-base;
        display: flex;
        align-items: center;
        gap: $spacing-xs;
        
        &:hover {
          transform: translateY(-3px);
          box-shadow: $shadow-md;
        }
      }
    }
  }
  
  /* Modal Form Styling */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba($black, 0.5);
    backdrop-filter: blur(5px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: $z-index-modal;
    padding: $spacing-md;
    
    .modal-container {
      background-color: $white;
      border-radius: $border-radius-lg;
      width: 100%;
      max-width: 650px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: $shadow-lg;
      
      &::-webkit-scrollbar {
        width: 6px;
      }
      
      &::-webkit-scrollbar-track {
        background: rgba($doctor-secondary, 0.2);
        border-radius: $border-radius-sm;
      }
      
      &::-webkit-scrollbar-thumb {
        background: $doctor-primary;
        border-radius: $border-radius-sm;
      }
      
      .modal-header {
        padding: $spacing-md $spacing-lg;
        border-bottom: 1px solid rgba($doctor-primary, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        background-color: $white;
        z-index: $z-index-sticky;
        
        h2 {
          margin: 0;
          color: $doctor-primary;
          font-weight: $font-weight-bold;
          font-size: $font-size-lg * 1.3;
        }
        
        .close-button {
          background: none;
          border: none;
          color: $text-secondary;
          font-size: $font-size-lg;
          cursor: pointer;
          width: 30px;
          height: 30px;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: $border-radius-circle;
          transition: $transition-base;
          
          &:hover {
            background-color: rgba($doctor-primary, 0.1);
            color: $doctor-primary;
            transform: rotate(90deg);
          }
        }
      }
      
      form {
        padding: $spacing-lg;
        
        .form-row {
          display: flex;
          gap: $spacing-md;
          margin-bottom: $spacing-md;
          
          .form-group {
            flex: 1;
          }
        }
        
        .form-group {
          margin-bottom: $spacing-md;
          
          label {
            display: block;
            margin-bottom: $spacing-xs;
            font-weight: $font-weight-medium;
            color: $text-primary;
            display: flex;
            align-items: center;
            gap: $spacing-xs;
            
            .input-icon {
              color: $doctor-primary;
            }
            
            .required {
              color: $alert-danger;
              margin-left: 4px;
            }
          }
          
          input, textarea, select {
            width: 100%;
            padding: $spacing-sm;
            border: 1px solid rgba($doctor-primary, 0.2);
            border-radius: $border-radius-md;
            font-size: $font-size-base;
            transition: $transition-base;
            
            &:focus {
              outline: none;
              border-color: $doctor-primary;
              box-shadow: 0 0 0 3px rgba($doctor-primary, 0.1);
            }
          }
          
          textarea {
            resize: vertical;
            min-height: 100px;
          }
          
          .current-image-preview {
            margin: $spacing-sm 0;
            border-radius: $border-radius-md;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            
            img {
              width: 100%;
              height: 150px;
              object-fit: cover;
              transition: $transition-base;
            }
            
            span {
              position: absolute;
              bottom: 0;
              left: 0;
              right: 0;
              padding: $spacing-xs;
              background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
              color: $white;
              font-size: $font-size-sm;
              text-align: center;
            }
            
            &:hover img {
              transform: scale(1.05);
            }
          }
          
          .file-upload {
            margin-top: $spacing-xs;
            
            .upload-label {
              display: block;
              margin-bottom: $spacing-xs;
            }
            
            input[type="file"] {
              border: 1px dashed rgba($doctor-primary, 0.3);
              padding: $spacing-md;
              background-color: rgba($doctor-secondary, 0.1);
              
              &::file-selector-button {
                padding: $spacing-xs $spacing-sm;
                background: $doctor-gradient;
                color: $white;
                border: none;
                border-radius: $border-radius-sm;
                margin-right: $spacing-sm;
                cursor: pointer;
                transition: $transition-base;
                
                &:hover {
                  box-shadow: $shadow-sm;
                }
              }
            }
            
            .file-name {
              margin-top: $spacing-xs;
              font-size: $font-size-sm;
              color: $doctor-primary;
            }
          }
        }
        
        .form-actions {
          display: flex;
          gap: $spacing-md;
          margin-top: $spacing-lg;
          
          button {
            flex: 1;
            padding: $spacing-sm $spacing-md;
            border: none;
            border-radius: $border-radius-md;
            font-weight: $font-weight-medium;
            cursor: pointer;
            transition: $transition-base;
            
            &.submit-button {
              background: $doctor-gradient;
              color: $white;
              
              &:hover {
                box-shadow: $shadow-md;
                transform: translateY(-3px);
              }
            }
            
            &.cancel-button {
              background-color: rgba($doctor-secondary, 0.2);
              color: $doctor-dark;
              
              &:hover {
                background-color: rgba($doctor-secondary, 0.4);
              }
            }
          }
        }
      }
    }
  }
  
  /* Loading Overlay */
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba($white, 0.8);
    backdrop-filter: blur(5px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: $z-index-modal;
    
    .loading-spinner {
      padding: $spacing-lg;
      background-color: $white;
      border-radius: $border-radius-lg;
      box-shadow: $shadow-lg;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: $spacing-md;
      
      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba($doctor-primary, 0.1);
        border-left-color: $doctor-primary;
        border-radius: $border-radius-circle;
        animation: spin 1s linear infinite;
      }
      
      p {
        margin: 0;
        color: $text-primary;
        font-weight: $font-weight-medium;
      }
    }
  }
  
  /* Alert History Modal */
  .alert-history-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba($black, 0.5);
    backdrop-filter: blur(5px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: $z-index-modal;
    padding: $spacing-md;
    
    .alert-history-content {
      background-color: $white;
      border-radius: $border-radius-lg;
      width: 100%;
      max-width: 600px;
      max-height: 80vh;
      box-shadow: $shadow-lg;
      overflow: hidden;
      
      .alert-history-header {
        padding: $spacing-md;
        background-color: rgba($doctor-primary, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        
        h3 {
          margin: 0;
          color: $doctor-primary;
          font-weight: $font-weight-medium;
        }
        
        button {
          background: none;
          border: none;
          color: $text-secondary;
          cursor: pointer;
          width: 30px;
          height: 30px;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: $border-radius-circle;
          transition: $transition-base;
          
          &:hover {
            background-color: rgba($doctor-primary, 0.1);
            color: $doctor-primary;
            transform: rotate(90deg);
          }
        }
      }
      
      .alert-history-body {
        padding: $spacing-md;
        overflow-y: auto;
        max-height: calc(80vh - 60px);
        
        &::-webkit-scrollbar {
          width: 6px;
        }
        
        &::-webkit-scrollbar-track {
          background: rgba($doctor-secondary, 0.2);
          border-radius: $border-radius-sm;
        }
        
        &::-webkit-scrollbar-thumb {
          background: $doctor-primary;
          border-radius: $border-radius-sm;
        }
        
        .alert-history-item {
          margin-bottom: $spacing-md;
          padding-bottom: $spacing-md;
          border-bottom: 1px solid rgba($doctor-primary, 0.1);
          
          &:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
          }
          
          .alert-history-date {
            display: flex;
            align-items: center;
            margin-bottom: $spacing-sm;
            
            svg {
              color: $doctor-primary;
              margin-right: $spacing-xs;
            }
            
            .alert-history-week {
              margin-left: $spacing-sm;
              background-color: rgba($doctor-primary, 0.1);
              padding: $spacing-xs $spacing-sm;
              border-radius: $border-radius-md;
              font-size: $font-size-sm;
              color: $doctor-primary;
            }
          }
          
          .alert-history-alerts {
            .alert-detail {
              display: flex;
              align-items: flex-start;
              margin-bottom: $spacing-xs;
              padding: $spacing-sm;
              background-color: rgba($doctor-secondary, 0.1);
              border-radius: $border-radius-md;
              border-left: 3px solid $doctor-primary;
              
              .warning-icon {
                color: $alert-warning;
                margin-right: $spacing-xs;
                flex-shrink: 0;
              }
              
              span {
                font-size: $font-size-sm;
                color: $text-secondary;
                line-height: 1.5;
              }
            }
          }
        }
        
        .no-alerts-history {
          text-align: center;
          padding: $spacing-xl 0;
          
          svg {
            color: rgba($doctor-primary, 0.3);
            margin-bottom: $spacing-sm;
          }
          
          p {
            margin: 0;
            color: $text-secondary;
          }
        }
      }
    }
  }
  
  /* Responsive Styles */
  @media (max-width: $breakpoint-xl) {
    .doctor-notes-container {
      padding: $spacing-md;
      
      .notes-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      }
    }
  }
  
  @media (max-width: $breakpoint-lg) {
    .doctor-notes-container {
      .doctor-notes-header {
        .search-filter-container {
          flex-direction: column;
          align-items: stretch;
          
          .search-box, .filter-box {
            width: 100%;
          }
          
          .add-note-button {
            align-self: flex-end;
          }
        }
      }
    }
  }
  
  @media (max-width: $breakpoint-md) {
    .doctor-notes-container {
      padding: $spacing-sm;
      
      .doctor-notes-header {
        h1 {
          font-size: $font-size-lg * 1.5;
        }
      }
      
      .modal-container {
        form {
          .form-row {
            flex-direction: column;
          }
          
          .form-actions {
            flex-direction: column;
          }
        }
      }
    }
  }
}